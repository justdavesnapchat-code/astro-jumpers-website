<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Jumpers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
    <!-- STYLES (Unchanged) -->
    <style>
        :root { --background-dark: #0c0a1a; --primary-purple: #6c25be; }
        body { background-color: var(--background-dark); color: #ffffff; font-family: 'Space Grotesk', sans-serif; }
        .animated-gradient { background: linear-gradient(300deg, var(--background-dark), #2a1a3c, var(--background-dark)); background-size: 200% 200%; animation: gradient-animation 15s ease infinite; }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .section-title-container { border-bottom: 2px solid; border-image: linear-gradient(to right, transparent, var(--primary-purple), transparent) 1; padding-bottom: 0.5rem; }
        .star-rating { color: #f59e0b; }
        .prose-content p { margin-bottom: 1.5rem; line-height: 1.75; }
        .prose-content img { margin-top: 1.5rem; margin-bottom: 1.5rem; border-radius: 0.5rem; }
        .prose-content blockquote { border-left: 4px solid var(--primary-purple); padding-left: 1rem; margin-left: 0; font-style: italic; color: #d1d5db; }
    </style>
</head>
<body class="animated-gradient">
    <!-- HEADER (Unchanged) -->
    <header class="bg-black/30 backdrop-blur-lg sticky top-0 z-40 border-b border-purple-800/50">
        <!-- ... Your standard header HTML ... -->
    </header>

    <!-- ARTICLE CONTENT -->
    <main id="article-main-content" class="max-w-4xl mx-auto p-4 md:p-8">
        <p class="text-center text-lg text-gray-400">Loading article...</p>
    </main>

    <!-- FOOTER (Unchanged) -->
    <footer class="bg-black/30 border-t border-purple-800/50 mt-16">
        <!-- ... Your standard footer HTML ... -->
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const mainContent = document.getElementById('article-main-content');

        // --- ARTICLE TEMPLATES (Unchanged) ---
        // ... Your getNewsArticleHTML and getReviewArticleHTML functions ...

        // --- NEW SECURE ARTICLE LOADING LOGIC ---
        (async () => {
            try {
                // Step 1: Fetch the secure config
                const configResponse = await fetch('/.netlify/functions/get-config');
                const firebaseConfig = await configResponse.json();

                // Step 2: Initialize Firebase
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);

                // Step 3: Load the article as before
                await loadArticle(db);

            } catch (error) {
                console.error("Error initializing Firebase or loading article:", error);
                mainContent.innerHTML = `<h1 class="text-center text-3xl font-bold text-red-500">Error</h1><p class="text-center">Could not load the article.</p>`;
            }
        })();
        
        async function loadArticle(db) {
            const urlParams = new URLSearchParams(window.location.search);
            const articleSlug = urlParams.get('slug');

            if (!articleSlug) {
                mainContent.innerHTML = `<h1 class="text-center text-3xl font-bold text-red-500">Article Not Found</h1>`;
                return;
            }

            const articlesCollection = collection(db, 'articles');
            const articleQuery = query(articlesCollection, where("slug", "==", articleSlug), limit(1));
            
            const querySnapshot = await getDocs(articleQuery);
            if (querySnapshot.empty) {
                mainContent.innerHTML = `<h1 class="text-center text-3xl font-bold text-red-500">Article Not Found</h1>`;
                return;
            }

            const article = querySnapshot.docs[0].data();
            document.title = `${article.title} - Astro Jumpers`;

            if (article.category === 'review') {
                mainContent.innerHTML = getReviewArticleHTML(article);
            } else {
                mainContent.innerHTML = getNewsArticleHTML(article);
            }
        }
    </script>
</body>
</html>

