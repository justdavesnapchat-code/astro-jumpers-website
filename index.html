<!DOCTYPE html>
<html lang="en" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Astro Jumpers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- 
    ==================================================================
    1. PASTE YOUR MAIN ADSTERRA POP-UNDER / SOCIAL BAR SCRIPT CODE HERE
    ==================================================================
    -->

    <style>
        :root { --background-dark: #0c0a1a; --primary-purple: #6c25be; --primary-pink: #da4ea2; }
        body { background-color: var(--background-dark); color: #ffffff; font-family: 'Space Grotesk', sans-serif; touch-action: manipulation; }
        .text-glow { text-shadow: 0 0 8px #ff00ff, 0 0 20px var(--primary-purple); }
        .btn { font-family: 'Press Start 2P', cursive; background: linear-gradient(45deg, var(--primary-pink), var(--primary-purple)); border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1.2rem; color: white; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(218, 78, 162, 0.5); }
        .btn:disabled { background: #4b5563; cursor: not-allowed; transform: translateY(0); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-neon { font-family: 'Press Start 2P', cursive; display: inline-block; padding: 10px 20px; border: 2px solid var(--primary-purple); border-radius: 8px; color: var(--primary-purple); text-shadow: 0 0 5px var(--primary-purple); box-shadow: 0 0 10px var(--primary-purple), inset 0 0 10px var(--primary-purple); transition: all 0.2s ease-in-out; text-align: center; }
        .btn-neon:hover { color: white; background-color: var(--primary-purple); text-shadow: 0 0 10px white; box-shadow: 0 0 20px var(--primary-purple), inset 0 0 5px var(--primary-purple); }
        .btn-neon:active { transform: scale(0.95); box-shadow: 0 0 5px var(--primary-purple), inset 0 0 15px var(--primary-purple); }
        #gameCanvas { background: var(--background-dark); background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 40px), radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 30px), radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 40px), radial-gradient(rgba(255,255,255,.4), rgba(255,255,255,.1) 2px, transparent 30px); background-size: 550px 550px, 350px 350px, 250px 250px, 150px 150px; background-position: 0 0, 40px 60px, 130px 270px, 70px 100px; animation: stars 60s linear infinite; cursor: pointer; display: block; transition: background-color 3s ease-in-out; width: 100%; height: 100%; }
        @keyframes stars { from { background-position: 0 0, 40px 60px, 130px 270px, 70px 100px; } to { background-position: 0 1000px, 40px 1060px, 130px 1270px, 70px 1100px; } }
        .hud { position: absolute; left: 50%; transform: translateX(-50%); text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff; font-family: 'Press Start 2P', cursive; }
        .modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(12, 10, 26, 0.8); border: 2px solid var(--primary-purple); border-radius: 16px; padding: 1.5rem; text-align: center; box-shadow: 0 0 30px var(--primary-purple); backdrop-filter: blur(5px); width: 90%; max-width: 500px; font-family: 'Press Start 2P', cursive;}
        .leaderboard-entry { display: flex; justify-content: space-between; padding: 0.5rem 1rem; border-radius: 8px; font-family: 'Space Grotesk', sans-serif; font-weight: 700; transition: background-color 0.2s ease-in-out; }
        .leaderboard-entry:nth-child(odd) { background-color: rgba(255,255,255,0.05); }
        .leaderboard-entry.rank-1 { background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.2)); border: 1px solid rgba(255, 215, 0, 0.3); }
        .name-input { background-color: rgba(255,255,255,0.1); border: 1px solid var(--primary-purple); border-radius: 8px; padding: 0.5rem 1rem; color: white; text-align: center; font-family: 'Press Start 2P', cursive; }
        .character-option.selected { border-color: #a855f7; box-shadow: 0 0 15px #a855f7; }
        .animated-gradient { background: linear-gradient(300deg, var(--background-dark), #2a1a3c, var(--background-dark)); background-size: 200% 200%; animation: gradient-animation 15s ease infinite; }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        #nav-menu { transition: max-height 0.3s ease-out; }
        .live-dot { width: 12px; height: 12px; min-width: 12px; background-color: #ef4444; border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .star-rating { color: #f59e0b; text-shadow: 0px 0px 2px black, 0px 0px 4px black; }
        .section-title-container { border-bottom: 2px solid; border-image: linear-gradient(to right, transparent, var(--primary-purple), transparent) 1; padding-bottom: 0.5rem; }
    </style>
</head>
<body class="animated-gradient">

    <header class="bg-black/30 backdrop-blur-lg sticky top-0 z-40 border-b border-purple-800/50">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html">
                        <img src="https://i.imgur.com/aeDmJZR.png" alt="Astro Jumpers Logo" class="h-10">
                    </a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#game-section-container" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Game</a>
                        <a href="#leaderboard-container" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Leaderboard</a>
                        <a href="news-page.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">News</a>
                        <a href="reviews-page.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Reviews</a>
                        <a href="#" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium opacity-50 cursor-not-allowed">Merch (Soon)</a>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button id="hamburger-button" type="button" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
        </nav>
        <div class="md:hidden max-h-0 overflow-hidden" id="nav-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#game-section-container" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Game</a>
                <a href="#leaderboard-container" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Leaderboard</a>
                <a href="news-page.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">News</a>
                <a href="reviews-page.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Reviews</a>
                <a href="#" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium opacity-50 cursor-not-allowed">Merch (Soon)</a>
            </div>
        </div>
    </header>

    <main id="main-content" class="max-w-7xl mx-auto p-4 space-y-12 md:space-y-16">
        <section id="game-section-container" class="w-full pt-8 md:pt-12">
            <div class="text-center mb-8">
                <h1 class="text-4xl md:text-6xl font-bold text-glow" style="font-family: 'Press Start 2P', cursive;">PLAY THE VIRAL GAME</h1>
                <p class="mt-4 text-lg md:text-xl text-gray-300 max-w-2xl mx-auto">The internet is hooked, but can you survive? Jump your way to the top of the LIVE global leaderboard and prove you're the best jumper in the galaxy!</p>
            </div>
             <div id="game-wrapper" class="w-full h-[60vh] md:h-[70vh] max-h-[800px] rounded-2xl overflow-hidden border-2 border-purple-800/50 relative bg-black shadow-2xl shadow-purple-900/50">
                <canvas id="gameCanvas"></canvas>
                <div id="initial-start-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-black/50 p-4">
                    <div class="text-center flex flex-col items-center gap-2 sm:gap-4">
                        <p class="text-xs sm:text-sm md:text-base mb-2">Hold to charge jump.<br>Aim, or click center to go up!</p>
                        <p class="text-xs uppercase tracking-widest">Choose Your Hero</p>
                        <div class="flex justify-center gap-2 sm:gap-4 mb-2">
                             <div class="character-option p-2 border-2 border-transparent rounded-lg cursor-pointer transition-all" data-character="astronaut"><div title="Astronaut" class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-900 rounded-md flex items-center justify-center overflow-hidden"><svg viewBox="0 0 30 45" class="h-10 sm:h-12"><g fill="#e5e7eb"><rect x="2.5" y="11" width="25" height="28"/><path d="M15 4c-6 0-11 6-11 12v1H15Z"/><path d="M15 4c6 0 11 6 11 12v1H15Z"/></g><circle cx="15" cy="17" r="9" fill="#111827"/><circle cx="19" cy="15" r="3" fill="rgba(255,255,255,0.3)"/><path d="M3 30 l-5 7 h10 Z" fill="#6b7280"/><path d="M27 30 l5 7 h-10 Z" fill="#6b7280"/></svg></div></div>
                             <div class="character-option p-2 border-2 border-transparent rounded-lg cursor-pointer transition-all" data-character="alien"><div title="Alien" class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-900 rounded-md flex items-center justify-center overflow-hidden"><svg viewBox="0 0 30 45" class="h-10 sm:h-12"><ellipse cx="15" cy="25" rx="14" ry="16" fill="#4ade80"/><circle cx="15" cy="18" r="10" fill="#f0fdf4"/><circle cx="15" cy="18" r="4" fill="#111827"/><path d="M15 8 L 15 2" stroke="#22c55e" stroke-width="2"/><circle cx="15" cy="2" r="3" fill="#f43f5e"/></svg></div></div>
                             <div class="character-option p-2 border-2 border-transparent rounded-lg cursor-pointer transition-all" data-character="robot"><div title="Robot" class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-900 rounded-md flex items-center justify-center overflow-hidden"><svg viewBox="0 0 30 45" class="h-10 sm:h-12"><rect x="2" y="2" width="26" height="12" fill="#d1d5db"/><rect x="2" y="14" width="26" height="28" fill="#9ca3af"/><circle cx="15" cy="8" r="4" fill="#ef4444"/><circle cx="15" cy="8" r="8" fill="rgba(255,100,100,0.5)"/></svg></div></div>
                        </div>
                        <button id="initial-startButton" class="btn text-base sm:text-xl py-2 px-4">START GAME</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="leaderboard-container" class="bg-black/30 rounded-2xl p-4 md:p-6 border border-purple-800/50 max-w-2xl mx-auto">
            <div class="section-title-container">
                 <h2 class="text-2xl md:text-3xl font-bold text-center flex items-center justify-center gap-x-3" style="font-family: 'Press Start 2P', cursive;">
                    <span class="live-dot"></span>
                    <span>LIVE GLOBAL LEADERBOARD</span>
                 </h2>
            </div>
             <div id="landing-leaderboard-list" class="space-y-2 mt-6">
                 <div class="text-center text-gray-400">Loading scores...</div>
             </div>
        </section>
        
        <section id="news-section" class="max-w-4xl mx-auto">
            <div class="section-title-container">
                <h2 class="text-2xl md:text-3xl font-bold text-center" style="font-family: 'Press Start 2P', cursive;">Gaming & Tech News</h2>
            </div>
            <div id="latest-news-list" class="space-y-4 mt-6">
                <p class="text-center text-gray-400">Loading latest news...</p>
            </div>
            <div class="text-center mt-8">
                <a href="news-page.html" class="btn-neon text-sm">More News...</a>
            </div>
        </section>
<script type="text/javascript">
	atOptions = {
		'key' : 'e7a81ac07ac7c3ba6b566dc09abc3548',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/e7a81ac07ac7c3ba6b566dc09abc3548/invoke.js"></script>
        <section id="reviews-section" class="max-w-4xl mx-auto">
             <div class="section-title-container">
                <h2 class="text-2xl md:text-3xl font-bold text-center" style="font-family: 'Press Start 2P', cursive;">Product Reviews</h2>
            </div>
            <div id="latest-reviews-list" class="space-y-4 mt-6">
                 <p class="text-center text-gray-400">Loading latest reviews...</p>
            </div>
             <div class="text-center mt-8">
                <a href="reviews-page.html" class="btn-neon text-sm">More Reviews...</a>
            </div>
        </section>
    </main>

    <footer class="bg-black/30 border-t border-purple-800/50 mt-16">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
                <div class="col-span-2 md:col-span-1">
                    <a href="index.html">
                        <img src="https://i.imgur.com/aeDmJZR.png" alt="Astro Jumpers Logo" class="h-10">
                    </a>
                    <p class="mt-4 text-gray-400 text-sm">The galaxy's most addictive arcade game and your new home for gaming & tech news.</p>
                </div>
                <div>
                    <h3 class="text-sm font-semibold tracking-wider uppercase">Navigation</h3>
                    <ul class="mt-4 space-y-4">
                        <li><a href="#game-section-container" class="text-base text-gray-300 hover:text-white">Game</a></li>
                        <li><a href="#leaderboard-container" class="text-base text-gray-300 hover:text-white">Leaderboard</a></li>
                        <li><a href="news.html" class="text-base text-gray-300 hover:text-white">News</a></li>
                        <li><a href="reviews.html" class="text-base text-gray-300 hover:text-white">Reviews</a></li>
                    </ul>
                </div>
                <div>
                     <h3 class="text-sm font-semibold tracking-wider uppercase">Legal</h3>
                     <ul class="mt-4 space-y-4">
                         <li><a href="#" class="text-base text-gray-300 hover:text-white">About Us</a></li>
                         <li><a href="#" class="text-base text-gray-300 hover:text-white">Contact Us</a></li>
                         <li><a href="#" class="text-base text-gray-300 hover:text-white">Privacy Policy</a></li>
                         <li><a href="#" class="text-base text-gray-300 hover:text-white">Terms & Conditions</a></li>
                     </ul>
                </div>
            </div>
            <div class="mt-8 border-t border-purple-800/50 pt-8 text-center text-sm text-gray-400">
                <p>&copy; 2025 Astro Jumpers. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <div id="game-fullscreen-container" class="hidden fixed top-0 left-0 w-screen h-screen z-[100]">
        <div id="ad-banner-top" class="absolute top-0 left-0 w-full h-[60px] flex items-center justify-center">
            <div class="w-[320px] h-[50px] bg-black/30 border-2 border-dashed border-purple-700 flex items-center justify-center text-purple-400 text-sm" style="font-family: 'Press Start 2P', cursive;">
                <span>Ad Banner</span>
            </div>
        </div>
        <div id="game-runtime-container" class="relative w-full h-full">
            <div id="score" class="hud top-[80px] text-2xl md:text-4xl">SCORE: 0</div>
            <div id="highScore" class="hud top-[130px] md:top-[140px] text-lg md:text-xl opacity-70">BEST: 0</div>
            <div id="startScreen" class="modal flex flex-col items-center gap-2 sm:gap-4">
                <h1 class="text-2xl sm:text-4xl md:text-5xl font-bold mb-2 text-shadow">ASTRO JUMPERS</h1>
                <p class="text-xs sm:text-sm md:text-base mb-2">Hold to charge jump.<br>Aim, or click center to go up!</p>
                <p class="text-xs uppercase tracking-widest">Choose Your Hero</p>
                <div id="character-select" class="flex justify-center gap-2 sm:gap-4 mb-2">
                    <div class="character-option p-2 border-2 border-transparent rounded-lg cursor-pointer transition-all" data-character="astronaut"><div title="Astronaut" class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-900 rounded-md flex items-center justify-center overflow-hidden"><svg viewBox="0 0 30 45" class="h-10 sm:h-12"><g fill="#e5e7eb"><rect x="2.5" y="11" width="25" height="28"/><path d="M15 4c-6 0-11 6-11 12v1H15Z"/><path d="M15 4c6 0 11 6 11 12v1H15Z"/></g><circle cx="15" cy="17" r="9" fill="#111827"/><circle cx="19" cy="15" r="3" fill="rgba(255,255,255,0.3)"/><path d="M3 30 l-5 7 h10 Z" fill="#6b7280"/><path d="M27 30 l5 7 h-10 Z" fill="#6b7280"/></svg></div></div>
                    <div class="character-option p-2 border-2 border-transparent rounded-lg cursor-pointer transition-all" data-character="alien"><div title="Alien" class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-900 rounded-md flex items-center justify-center overflow-hidden"><svg viewBox="0 0 30 45" class="h-10 sm:h-12"><ellipse cx="15" cy="25" rx="14" ry="16" fill="#4ade80"/><circle cx="15" cy="18" r="10" fill="#f0fdf4"/><circle cx="15" cy="18" r="4" fill="#111827"/><path d="M15 8 L 15 2" stroke="#22c55e" stroke-width="2"/><circle cx="15" cy="2" r="3" fill="#f43f5e"/></svg></div></div>
                    <div class="character-option p-2 border-2 border-transparent rounded-lg cursor-pointer transition-all" data-character="robot"><div title="Robot" class="w-14 h-14 sm:w-16 sm:h-16 bg-gray-900 rounded-md flex items-center justify-center overflow-hidden"><svg viewBox="0 0 30 45" class="h-10 sm:h-12"><rect x="2" y="2" width="26" height="12" fill="#d1d5db"/><rect x="2" y="14" width="26" height="28" fill="#9ca3af"/><circle cx="15" cy="8" r="4" fill="#ef4444"/><circle cx="15" cy="8" r="8" fill="rgba(255,100,100,0.5)"/></svg></div></div>
                </div>
                <button id="startButton" class="btn text-base sm:text-xl py-2 px-4">START GAME</button>
            </div>
            <div id="gameOverScreen" class="modal hidden flex-col items-center gap-2 sm:gap-3">
                <h1 class="text-2xl sm:text-4xl md:text-5xl font-bold mb-1">GAME OVER</h1>
                <p class="text-base sm:text-lg md:text-xl mb-1">Your Score: <span id="finalScore">0</span></p>
                <div id="highScoreForm" class="hidden w-full flex-col items-center gap-2">
                    <p class="text-xs sm:text-sm">New high score! Enter your name:</p>
                    <input type="text" id="playerName" class="name-input text-sm w-full" maxlength="10" placeholder="AAA">
                    <button id="submitScoreButton" class="btn text-sm py-2 px-4 mt-1">Submit</button>
                </div>
                <div id="leaderboard" class="w-full mt-2">
                    <h2 class="text-base sm:text-lg md:text-xl mb-2">LEADERBOARD</h2>
                    <div id="leaderboard-list" class="text-xs sm:text-sm md:text-base"></div>
                </div>
                <button id="restartButton" class="btn mt-2 text-base sm:text-xl py-2 px-4">TRY AGAIN</button>
                <button id="exitGameButton" class="bg-gray-700 hover:bg-gray-600 text-white font-bold text-xs py-2 px-4 rounded-lg transition-colors duration-300 mt-4" style="font-family: 'Press Start 2P', cursive;">EXIT</button>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, limit, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // This listener ensures the entire script runs *after* the initial HTML is parsed.
        document.addEventListener('DOMContentLoaded', () => {
            // --- All variables and functions are now safely inside this listener ---

            // --- Firebase and Dynamic Content Variables ---
            let db, auth;
            let leaderboard = []; 
            const LEADERBOARD_SIZE = 10;
            const landingLeaderboardListEl = document.getElementById('landing-leaderboard-list');
            const mainContent = document.getElementById('main-content');
            
            // --- Game Variables ---
            const hamburgerButton = document.getElementById('hamburger-button');
            const navMenu = document.getElementById('nav-menu');
            const initialStartButton = document.getElementById('initial-startButton');
            const gameFullscreenContainer = document.getElementById('game-fullscreen-container');
            const gameRuntimeContainer = document.getElementById('game-runtime-container');
            const canvas = document.getElementById('gameCanvas'); 
            const ctx = canvas.getContext('2d');
            const scoreEl = document.getElementById('score'); const highScoreEl = document.getElementById('highScore'); const startScreen = document.getElementById('startScreen'); const gameOverScreen = document.getElementById('gameOverScreen'); const startButton = document.getElementById('startButton'); const restartButton = document.getElementById('restartButton'); const finalScoreEl = document.getElementById('finalScore'); const highScoreForm = document.getElementById('highScoreForm'); const playerNameInput = document.getElementById('playerName'); const submitScoreButton = document.getElementById('submitScoreButton'); const leaderboardListEl = document.getElementById('leaderboard-list');
            const exitGameButton = document.getElementById('exitGameButton');
            let isGameRunning = false; let score = 0; let highScore = localStorage.getItem('astroJumperHighScore') || 0; let cameraY = 0; let player, asteroids, particles; let pressStartTime = 0; let lastClickX = 0; let jumpDirection = 1; let currentLevelIndex = 0; let selectedCharacter = localStorage.getItem('astroJumperCharacter') || 'astronaut';
            const levels = [{ threshold: 0, bgColor: '#0c0a1a' },{ threshold: 100, bgColor: '#1a122a' },{ threshold: 200, bgColor: '#2a1a3c' },{ threshold: 300, bgColor: '#3c1f4f' },{ threshold: 400, bgColor: '#4a1a3c' },{ threshold: 500, bgColor: '#5a2a2a' },{ threshold: 750, bgColor: '#4a3a2a' },{ threshold: 1000, bgColor: '#2a5a2a' },{ threshold: 1500, bgColor: '#2a5a5a' },{ threshold: 2000, bgColor: '#3a3a5a' },];
            let synth, landSynth, gameOverSynth; 

            // --- All Game and UI Functions ---
            function setupSounds() { if (typeof Tone === 'undefined' || Tone.context.state !== 'running') return; synth = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.1 } }).toDestination(); landSynth = new Tone.NoiseSynth({ noise: { type: 'white' }, envelope: { attack: 0.001, decay: 0.05, sustain: 0, release: 0.1 } }).toDestination(); gameOverSynth = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.5, sustain: 0.1, release: 0.5 } }).toDestination(); }
            const playJumpSound = () => synth?.triggerAttackRelease('C5', '8n');
            const playLandSound = () => landSynth?.triggerAttackRelease('16n');
            const playGameOverSound = () => gameOverSynth?.triggerAttackRelease('C3', '2n');
            const playerProps = { width: 25, height: 40, velocityY: 0, gravity: 0.35, minJumpStrength: -6, maxJumpStrength: -14, sideStrength: 3.5, isGrounded: true, jumpFrame: 0 };
            function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
            function init() { resizeCanvas(); highScoreEl.textContent = `BEST: ${highScore}`; player = { ...playerProps, x: canvas.width / 2, y: canvas.height - 100 }; cameraY = 0; score = 0; scoreEl.textContent = 'SCORE: 0'; currentLevelIndex = 0; applyLevelStyles(); asteroids = []; particles = []; const startPlatform = { x: canvas.width / 2 - 50, y: canvas.height - 50, width: 100, height: 20 }; asteroids.push(startPlatform); let lastAsteroid = startPlatform; for (let i = 0; i < 15; i++) { lastAsteroid = createAsteroid(lastAsteroid); asteroids.push(lastAsteroid); } highScoreForm.classList.add('hidden'); gameOverScreen.classList.add('hidden'); startScreen.classList.remove('hidden'); updateCharacterSelectionUI(); }
            function updateCharacterSelectionUI() { document.querySelectorAll('.character-option').forEach(el => { el.classList.remove('selected'); if (el.dataset.character === selectedCharacter) el.classList.add('selected'); }); }
            function applyLevelStyles() { const level = levels[currentLevelIndex]; canvas.style.backgroundColor = level.bgColor; }
            function createAsteroid(previousAsteroid) { const newAsteroid = { width: 100 * (Math.random() * 0.5 + 0.75), height: 20, }; const maxHorizontalDist = Math.min(200, canvas.width * 0.45); const minVerticalDist = 100; const maxVerticalDist = 180; const newY = previousAsteroid.y - (Math.random() * (maxVerticalDist - minVerticalDist) + minVerticalDist); const horizontalOffset = (Math.random() - 0.5) * 2 * maxHorizontalDist; let newX = previousAsteroid.x + horizontalOffset; if (newX < 0) newX = 10; if (newX + newAsteroid.width > canvas.width) newX = canvas.width - newAsteroid.width - 10; newAsteroid.x = newX; newAsteroid.y = newY; return newAsteroid; }
            function startGame() { if (typeof Tone !== 'undefined' && Tone.context.state !== 'running') { Tone.start().then(setupSounds); } isGameRunning = true; startScreen.classList.add('hidden'); gameLoop(); }
            function gameOver() { isGameRunning = false; playGameOverSound(); if (score > highScore) { highScore = score; localStorage.setItem('astroJumperHighScore', highScore); } finalScoreEl.textContent = score; const lowestLeaderboardScore = leaderboard.length < LEADERBOARD_SIZE ? 0 : leaderboard[leaderboard.length - 1].score; if (score > 0 && score >= lowestLeaderboardScore) { highScoreForm.classList.remove('hidden'); playerNameInput.value = localStorage.getItem('astroJumperPlayerName') || ''; } renderLeaderboard(leaderboardListEl, 10, true); gameOverScreen.classList.remove('hidden'); }
            function jump(pressDuration) { if (player.isGrounded) { const centerZoneWidth = player.width * 1.2; const leftBound = player.x + (player.width / 2) - (centerZoneWidth / 2); const rightBound = player.x + (player.width / 2) + (centerZoneWidth / 2); if (lastClickX < leftBound) { jumpDirection = -1; } else if (lastClickX > rightBound) { jumpDirection = 1; } else { jumpDirection = 0; } const maxPressDuration = 500; const pressRatio = Math.min(pressDuration, maxPressDuration) / maxPressDuration; const jumpStrength = player.minJumpStrength + (player.maxJumpStrength - player.minJumpStrength) * pressRatio; player.velocityY = jumpStrength; player.isGrounded = false; createParticles(player.x + player.width / 2, player.y + player.height, 15, jumpDirection); playJumpSound(); } }
            function createParticles(x, y, count, direction) { for (let i = 0; i < count; i++) { particles.push({ x, y, size: Math.random() * 3 + 1, speedX: (Math.random() - 0.5 + direction * 0.5) * 3, speedY: Math.random() * 3 + 2, life: 50, color: `hsl(${Math.random() * 60 + 180}, 100%, 75%)` }); } }
            function updateParticles() { for (let i = particles.length - 1; i >= 0; i--) { const p = particles[i]; p.x += p.speedX; p.y += p.speedY; p.life--; if (p.life <= 0) particles.splice(i, 1); } }
            function drawParticles(ctx) { ctx.globalAlpha = 1; for (const p of particles) { ctx.fillStyle = p.color; ctx.globalAlpha = p.life / 50; ctx.beginPath(); ctx.arc(p.x, p.y - cameraY, p.size, 0, Math.PI * 2); ctx.fill(); } ctx.globalAlpha = 1; }
            function update() { if (!isGameRunning || !player) return; player.velocityY += player.gravity; if (!player.isGrounded) player.jumpFrame++; player.y += player.velocityY; if (!player.isGrounded) player.x += player.sideStrength * jumpDirection; if (player.x > canvas.width) player.x = 0; else if (player.x < -player.width) player.x = canvas.width - player.width; player.isGrounded = false; asteroids.forEach(asteroid => { if (player.velocityY > 0 && player.x < asteroid.x + asteroid.width && player.x + player.width > asteroid.x && player.y + player.height > asteroid.y && player.y + player.height < asteroid.y + asteroid.height + 10) { player.velocityY = 0; player.y = asteroid.y - player.height; if (!player.isGrounded) playLandSound(); player.isGrounded = true; } }); if (player.y < cameraY + canvas.height / 2) cameraY = player.y - canvas.height / 2; score = Math.max(score, Math.floor(-cameraY / 10)); scoreEl.textContent = `SCORE: ${score}`; const nextLevelIndex = currentLevelIndex + 1; if (nextLevelIndex < levels.length && score >= levels[nextLevelIndex].threshold) { currentLevelIndex = nextLevelIndex; applyLevelStyles(); } const topOfScreen = cameraY; const oldAsteroidsCount = asteroids.length; asteroids = asteroids.filter(a => a.y < topOfScreen + canvas.height + 100); const newAsteroidsCount = asteroids.length; const removedCount = oldAsteroidsCount - newAsteroidsCount; if (removedCount > 0) { let lastAsteroid = asteroids.reduce((prev, current) => (prev.y < current.y) ? prev : current); for (let i = 0; i < removedCount; i++) { lastAsteroid = createAsteroid(lastAsteroid); asteroids.push(lastAsteroid); } } updateParticles(); if (player.y > cameraY + canvas.height) gameOver(); }
            function draw() { ctx.clearRect(0, 0, canvas.width, canvas.height); if (!player) return; ctx.save(); ctx.translate(0, -cameraY); drawParticles(ctx); asteroids.forEach(asteroid => { ctx.fillStyle = '#9b7d60'; ctx.fillRect(asteroid.x, asteroid.y, asteroid.width, asteroid.height); ctx.fillStyle = '#c7a37f'; ctx.fillRect(asteroid.x, asteroid.y, asteroid.width, asteroid.height - 15); }); if (pressStartTime > 0 && player.isGrounded) { const pressDuration = Date.now() - pressStartTime; const maxPressDuration = 500; const pressRatio = Math.min(pressDuration, maxPressDuration) / maxPressDuration; const meterWidth = 50, meterHeight = 8; const meterX = player.x + (player.width / 2) - (meterWidth / 2); const meterY = player.y - 20; ctx.fillStyle = 'rgba(255, 255, 255, 0.3)'; ctx.fillRect(meterX, meterY, meterWidth, meterHeight); const gradient = ctx.createLinearGradient(meterX, meterY, meterX + meterWidth, meterY); gradient.addColorStop(0, '#86efac'); gradient.addColorStop(0.7, '#facc15'); gradient.addColorStop(1, '#ef4444'); ctx.fillStyle = gradient; ctx.fillRect(meterX, meterY, meterWidth * pressRatio, meterHeight); }  const frame = player.jumpFrame || 0; const bob = player.isGrounded ? Math.sin(Date.now() / 150) * 1.5 : 0; const px = player.x; const py = player.y + bob; const pw = player.width; const ph = player.height; switch (selectedCharacter) { case 'astronaut': { ctx.fillStyle = '#6b7280'; ctx.fillRect(px - 2, py + ph * 0.25, pw + 4, ph * 0.5); ctx.fillStyle = '#e5e7eb'; ctx.fillRect(px, py + ph * 0.2, pw, ph * 0.7); ctx.fillStyle = '#d1d5db'; if (!player.isGrounded) { ctx.fillRect(px + pw * 0.2, py + ph * 0.85, 5, 5); ctx.fillRect(px + pw * 0.6, py + ph * 0.85, 5, 5); } else { ctx.fillRect(px + pw * 0.2, py + ph * 0.85, 5, 8); ctx.fillRect(px + pw * 0.6, py + ph * 0.85, 5, 8); } ctx.fillStyle = '#f9fafb'; ctx.beginPath(); ctx.arc(px + pw / 2, py + ph * 0.2, pw / 2 + 2, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = '#111827'; ctx.beginPath(); ctx.arc(px + pw / 2, py + ph * 0.2, pw / 2 - 1, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = 'rgba(255, 255, 255, 0.3)'; ctx.beginPath(); ctx.arc(px + pw * 0.65, py + ph * 0.1, pw/5, 0, Math.PI*2); ctx.fill(); ctx.fillStyle = 'rgba(229, 231, 235, 0.5)'; ctx.beginPath(); ctx.arc(px + pw * 0.35, py + ph * 0.2, 2, 0, Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.arc(px + pw * 0.65, py + ph * 0.2, 2, 0, Math.PI*2); ctx.fill(); if (!player.isGrounded) { const flameSize = Math.sin(frame * 0.4) * 8 + 12; ctx.fillStyle = `rgba(252, 211, 77, ${Math.random() * 0.5 + 0.5})`; ctx.beginPath(); ctx.moveTo(px + pw * 0.3, py + ph * 0.7); ctx.lineTo(px + pw * 0.7, py + ph * 0.7); ctx.lineTo(px + pw / 2, py + ph * 0.7 + flameSize); ctx.closePath(); ctx.fill(); ctx.fillStyle = `rgba(249, 115, 22, ${Math.random() * 0.5 + 0.5})`; ctx.beginPath(); ctx.moveTo(px + pw * 0.4, py + ph * 0.7); ctx.lineTo(px + pw * 0.6, py + ph * 0.7); ctx.lineTo(px + pw / 2, py + ph * 0.7 + flameSize * 0.6); ctx.closePath(); ctx.fill(); } break; } case 'alien': { ctx.fillStyle = '#4d1b7b'; ctx.fillRect(px - 2, py + ph * 0.25, pw + 4, ph * 0.5); ctx.fillStyle = '#4ade80'; ctx.beginPath(); ctx.ellipse(px + pw / 2, py + ph * 0.6, pw / 2, ph * 0.4, 0, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = '#22c55e'; if (!player.isGrounded) { ctx.fillRect(px + pw * 0.2, py + ph * 0.85, 5, 5); ctx.fillRect(px + pw * 0.6, py + ph * 0.85, 5, 5); } else { ctx.fillRect(px + pw * 0.2, py + ph * 0.85, 5, 8); ctx.fillRect(px + pw * 0.6, py + ph * 0.85, 5, 8); } ctx.fillStyle = '#f0fdf4'; ctx.beginPath(); ctx.arc(px + pw / 2, py + ph * 0.25, pw / 2 + 2, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = '#111827'; ctx.beginPath(); ctx.arc(px + pw / 2, py + ph * 0.25, 4, 0, Math.PI * 2); ctx.fill(); ctx.strokeStyle = '#22c55e'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(px + pw / 2, py + ph * 0.1); ctx.lineTo(px + pw / 2, py - 5); ctx.stroke(); ctx.fillStyle = '#f43f5e'; ctx.beginPath(); ctx.arc(px + pw / 2, py - 7, 3, 0, Math.PI * 2); ctx.fill(); if (!player.isGrounded) { const flameSize = Math.sin(frame * 0.4) * 8 + 12; ctx.fillStyle = `rgba(192, 132, 252, ${Math.random() * 0.5 + 0.5})`; ctx.beginPath(); ctx.moveTo(px + pw * 0.3, py + ph * 0.7); ctx.lineTo(px + pw * 0.7, py + ph * 0.7); ctx.lineTo(px + pw / 2, py + ph * 0.7 + flameSize); ctx.closePath(); ctx.fill(); } break; } case 'robot': { ctx.fillStyle = '#4b5563'; ctx.fillRect(px - 2, py + ph * 0.6, pw/2 - 1, ph * 0.3); ctx.fillRect(px + pw/2 + 3, py + ph * 0.6, pw/2 - 1, ph * 0.3); ctx.fillStyle = '#9ca3af'; ctx.fillRect(px, py + ph * 0.2, pw, ph * 0.7); ctx.fillStyle = '#6b7280'; if (!player.isGrounded) { ctx.fillRect(px + pw * 0.2, py + ph * 0.85, 5, 5); ctx.fillRect(px + pw * 0.6, py + ph * 0.85, 5, 5); } else { ctx.fillRect(px + pw * 0.2, py + ph * 0.85, 5, 8); ctx.fillRect(px + pw * 0.6, py + ph * 0.85, 5, 8); } ctx.fillStyle = '#d1d5db'; ctx.fillRect(px, py, pw, ph * 0.3); ctx.fillStyle = '#ef4444'; ctx.beginPath(); ctx.arc(px + pw / 2, py + ph * 0.15, 4, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = 'rgba(255, 100, 100, 0.5)'; ctx.beginPath(); ctx.arc(px + pw / 2, py + ph * 0.15, 8, 0, Math.PI * 2); ctx.fill(); if (!player.isGrounded) { const flameSize = Math.sin(frame * 0.4) * 8 + 12; ctx.fillStyle = 'rgba(59, 130, 246, 0.8)'; ctx.beginPath(); ctx.moveTo(px - 2, py + ph * 0.9); ctx.lineTo(px + pw/2 - 1, py + ph * 0.9); ctx.lineTo(px + pw/4 - 1.5, py + ph * 0.9 + flameSize); ctx.closePath(); ctx.fill(); ctx.beginPath(); ctx.moveTo(px + pw/2 + 3, py + ph * 0.9); ctx.lineTo(px + pw + 2, py + ph * 0.9); ctx.lineTo(px + pw * 0.75 + 1.5, py + ph * 0.9 + flameSize); ctx.closePath(); ctx.fill(); } break; } } ctx.restore(); }
            function gameLoop() { update(); draw(); if (isGameRunning) requestAnimationFrame(gameLoop); }
            function setupCharacterSelection() {
                const updateSelection = (character) => {
                    selectedCharacter = character;
                    localStorage.setItem('astroJumperCharacter', character);
                    document.querySelectorAll('.character-option').forEach(opt => {
                        opt.classList.remove('selected');
                        if (opt.dataset.character === selectedCharacter) opt.classList.add('selected');
                    });
                };
                document.querySelectorAll('.character-option').forEach(el => {
                    el.addEventListener('click', (e) => {
                        e.stopPropagation();
                        updateSelection(el.dataset.character)
                    });
                });
                updateSelection(localStorage.getItem('astroJumperCharacter') || 'astronaut');
            }
            
            hamburgerButton.addEventListener('click', () => {
                const isExpanded = hamburgerButton.getAttribute('aria-expanded') === 'true';
                hamburgerButton.setAttribute('aria-expanded', !isExpanded);
                hamburgerButton.querySelectorAll('svg').forEach(s => s.classList.toggle('hidden'));
                if (navMenu.classList.contains('max-h-0')) {
                     navMenu.classList.remove('max-h-0');
                     navMenu.style.maxHeight = navMenu.scrollHeight + "px";
                } else {
                     navMenu.style.maxHeight = "0px";
                     navMenu.addEventListener('transitionend', () => navMenu.classList.add('max-h-0'), { once: true });
                }
            });
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    if (href && href !== '#') {
                        e.preventDefault();
                        const targetEl = document.querySelector(href);
                        if (targetEl) targetEl.scrollIntoView({ behavior: 'smooth' });
                    }
                    if(navMenu.classList.contains('max-h-0') === false) hamburgerButton.click();
                });
            });

            initialStartButton.addEventListener('click', () => {
                gameRuntimeContainer.prepend(canvas);
                gameFullscreenContainer.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                init();
                startGame();
            });
            exitGameButton.addEventListener('click', () => {
                isGameRunning = false;
                document.getElementById('game-wrapper').prepend(canvas);
                gameFullscreenContainer.classList.add('hidden');
                document.body.style.overflow = 'auto';
            });

            window.addEventListener('resize', () => { if(isGameRunning) { resizeCanvas(); } }); 
            startButton.addEventListener('click', startGame); 
            restartButton.addEventListener('click', () => { init(); startGame(); }); 
            
            submitScoreButton.addEventListener('click', () => {
                 submitScore();
                 localStorage.setItem('astroJumperPlayerName', playerNameInput.value.trim());
            });
            
            canvas.addEventListener('mousedown', (e) => { if (isGameRunning && player.isGrounded) { pressStartTime = Date.now(); lastClickX = e.clientX; } }); canvas.addEventListener('mouseup', (e) => { if (isGameRunning && pressStartTime > 0) { const d = Date.now() - pressStartTime; jump(d); pressStartTime = 0; } }); canvas.addEventListener('touchstart', (e) => { e.preventDefault(); if (isGameRunning && player.isGrounded) { pressStartTime = Date.now(); lastClickX = e.touches[0].clientX; } }, { passive: false }); canvas.addEventListener('touchend', (e) => { e.preventDefault(); if (isGameRunning && pressStartTime > 0) { const d = Date.now() - pressStartTime; jump(d); pressStartTime = 0; } }, { passive: false });
            
            setupCharacterSelection();
            
            async function initializeFirebase() {
                try {
                    const configResponse = await fetch('/.netlify/functions/get-config');
                    if (!configResponse.ok) throw new Error(`Failed to fetch config. Status: ${configResponse.status}.`);
                    const firebaseConfig = await configResponse.json();
                    if (!firebaseConfig.apiKey) throw new Error("Firebase API Key is missing.");
                    
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app); 
                    auth = getAuth(app);
                    
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) await signInWithCustomToken(auth, __initial_auth_token);
                    else await signInAnonymously(auth);
                    
                    listenForScores(); 
                    fetchHomepageArticles();

                } catch (error) {
                    console.error("A critical error occurred during initialization:", error);
                    if(mainContent) mainContent.innerHTML = `<div class="text-center p-8 bg-red-900/50 border-2 border-red-500 rounded-lg max-w-4xl mx-auto"><h1 class="text-2xl font-bold text-red-300">SITE OFFLINE</h1><p class="mt-4 text-lg text-red-200">A critical error occurred while loading the website.</p><pre class="mt-4 p-4 bg-black/50 text-left text-sm text-red-200 rounded-md overflow-x-auto">${error.message}</pre></div>`;
                }
            }

            function listenForScores() { 
                const scoresCollection = collection(db, `scores`);
                const q = query(scoresCollection, orderBy("score", "desc"), limit(LEADERBOARD_SIZE)); 
                onSnapshot(q, (snapshot) => { 
                    const scores = []; 
                    snapshot.forEach((doc) => { scores.push({ id: doc.id, ...doc.data() }); }); 
                    leaderboard = scores;
                    const landingListEl = document.getElementById('landing-leaderboard-list');
                    const modalListEl = document.getElementById('leaderboard-list');
                    if (landingListEl) renderLeaderboard(landingListEl, 5, false);
                    if (modalListEl) renderLeaderboard(modalListEl, 10, true);
                }); 
            }
            
            function renderLeaderboard(targetElement, limit, isModal) {
                if (!targetElement) return;
                targetElement.innerHTML = '';
                const scoresToRender = leaderboard.slice(0, limit);
                if (scoresToRender.length === 0) {
                    targetElement.innerHTML = `<p class="${isModal ? 'text-xs sm:text-sm' : ''} text-center text-gray-400">Be the first on the leaderboard!</p>`;
                    return;
                }
                scoresToRender.forEach((entry, index) => {
                    const entryDiv = document.createElement('div');
                    const rank = index + 1;
                    entryDiv.className = `leaderboard-entry ${isModal ? 'text-sm' : 'text-lg'} ${rank === 1 && !isModal ? 'rank-1' : ''}`;
                    const goldMedal = `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="#FFD700"/></svg>`;
                    const silverMedal = `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="#C0C0C0"/></svg>`;
                    const bronzeMedal = `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="#CD7F32"/></svg>`;
                    let rankDisplay = (rank === 1 && !isModal) ? goldMedal : (rank === 2 && !isModal) ? silverMedal : (rank === 3 && !isModal) ? bronzeMedal : `#${rank}`;
                    entryDiv.innerHTML = `<span class="w-10 flex items-center justify-center text-yellow-300">${rankDisplay}</span><span class="flex-1 text-left">${entry.name}</span><span class="w-20 text-right text-gray-300">${entry.score}</span>`;
                    targetElement.appendChild(entryDiv);
                });
            }

            async function submitScore() {
                const scoresCollection = collection(db, 'scores');
                const playerName = playerNameInput.value.trim(); 
                if (playerName && score > 0) { 
                    submitScoreButton.disabled = true;
                    submitScoreButton.textContent = "Submitting...";
                    try { 
                        await addDoc(scoresCollection, { name: playerName, score: score, createdAt: new Date() }); 
                        highScoreForm.classList.add('hidden'); 
                    } catch (e) { 
                        console.error("Error adding document: ", e); 
                        alert("Could not submit score. Please try again.");
                    } finally {
                        submitScoreButton.disabled = false;
                        submitScoreButton.textContent = "Submit";
                    }
                } 
            }

            async function fetchHomepageArticles() {
                const articlesCollection = collection(db, 'articles');
                const newsListContainer = document.getElementById('latest-news-list');
                const reviewsListContainer = document.getElementById('latest-reviews-list');
                const newsQuery = query(articlesCollection, where("category", "==", "news"), orderBy("publicationDate", "desc"), limit(2));
                populateArticleList(newsQuery, newsListContainer, createNewsCardHTML);
                const reviewsQuery = query(articlesCollection, where("category", "==", "review"), orderBy("publicationDate", "desc"), limit(2));
                populateArticleList(reviewsQuery, reviewsListContainer, createReviewCardHTML);
            }

            async function populateArticleList(q, container, templateFunction) {
                try {
                    const querySnapshot = await getDocs(q);
                    if (querySnapshot.empty) {
                        container.innerHTML = `<p class="text-center text-gray-500">No articles found.</p>`;
                        return;
                    }
                    container.innerHTML = '';
                    querySnapshot.forEach(doc => { container.innerHTML += templateFunction(doc.data()); });
                } catch (error) {
                    console.error("Error fetching articles:", error);
                    container.innerHTML = `<p class="text-center text-red-500">Error loading content.</p>`;
                }
            }

            function createNewsCardHTML(article) {
                const articleLink = `article.html?slug=${article.slug}`;
                return `<a href="${articleLink}" class="flex flex-col sm:flex-row bg-black/20 rounded-lg border border-transparent hover:border-purple-800/50 transition-all duration-300 overflow-hidden"><img src="${article.imageUrl}" alt="${article.title}" class="w-full h-32 sm:w-24 sm:h-auto object-cover"><div class="p-4 flex flex-col justify-center"><span class="text-xs font-bold uppercase text-purple-400">${article.category}</span><h3 class="font-bold text-lg text-white mt-1">${article.title}</h3><p class="text-sm text-gray-400 mt-1">${article.summary}</p></div></a>`;
            }

            function createReviewCardHTML(article) {
                const articleLink = `article.html?slug=${article.slug}`;
                const rating = article.rating || 0;
                const starsHTML = '★'.repeat(rating) + '<span class="text-gray-500">' + '★'.repeat(5 - rating) + '</span>';
                return `<a href="${articleLink}" class="flex flex-col sm:flex-row bg-black/20 rounded-lg border border-transparent hover:border-purple-800/50 transition-all duration-300 overflow-hidden"><img src="${article.imageUrl}" alt="${article.title}" class="w-full h-40 sm:w-48 sm:h-auto object-cover"><div class="p-4 flex flex-col"><h3 class="font-bold text-lg md:text-xl text-white">${article.title}</h3><p class="text-sm text-gray-400 mt-1 flex-grow">${article.summary}</p><div class="flex items-center justify-between mt-2"><div class="star-rating text-lg">${starsHTML}</div><span class="text-xs text-gray-500">By ${article.author}</span></div></div></a>`;
            }

            initializeFirebase();
        });
    </script>
</body>
</html>


